---
title: "Analysis of U.S. National Disease Death Trends (2014-2021)"
author: "Patrick Cook"
date: "8/13/2021"
output: 
  html_document:
    df_print: paged
    # keep_md: True
---

```{r, global.options, include = FALSE}
knitr::opts_chunk$set(
#    fig.width   = 12,        # the width for plots created by code chunk
#    fig.height  = 12,        # the height for plots created by code chunk
    dpi         = 200,        # set dpi for hd screen
    fig.align   = 'center',   # align graphics in the final doc
    out.width   = "90%",      # Set output (html) to % of window
    out.height  = "90%",      # Set output (html) to % of window
    fig.path    = 'images/',  # file path to graphics storage directory
    echo        = TRUE,       # do not display code in the code chunk
    message     = TRUE,       # do not display any messages generated by code
    strip.white = TRUE,       # remove white spaces at beg or end of code chunk
    warning     = TRUE,       # do not display any warning messages
    results     = TRUE)       # show text output
```


```{r , echo=FALSE}

# Update/Create cleaned data set and import variables and functions
  source("clean_and_merge.R")

```

**Note**: Initial data sets were cleaned and merged prior to this analysis. The 
original data sets' structure and cleaning steps may be found in the file 
[us_state_death_trends_wrangling](us_state_death_trends_wrangling.Rmd).

## Introduction and Objectives  

This report explores the Center for Disease Control's (CDC) Weekly Morbidity and 
Mortality data from 2014 through the **------>1st quarter of 2021<--------**. 
**This data analysis is focused on National level weekly death counts for specific 
causes at the United States**. A 2nd report will analyze specific state and local 
regions. The data is voluntary and not guaranteed to be reported in a timely or 
regular basis. Therefore, the most recent data (quarter) will be may be 
incomplete and unreliable for analysis and insights. 

More information on the original data sets can be found at CDC's website using 
the following links: 

- [2014-2015 MMWR Data Set](https://data.cdc.gov/NCHS/Weekly-Counts-of-Deaths-by-State-and-Select-Causes/3yf8-kanr){target="_blank"}
- [2020-2021 MMWR Data Set](https://data.cdc.gov/NCHS/Weekly-Provisional-Counts-of-Deaths-by-State-and-S/muzy-jte6){target="_blank"}

**Note**: The most current data can be downloaded using the links above. To use the 
data sets without any code modifications, the user will need to:

1. Place the data two sets in a subdirectory named "data", and
2. Rename the data sets as "weekly_2014_2019" and "weekly_2020_2021."


```{r}
# Create United States subset
us_deaths_df <- mmwr_1421_df[Location == "United States", ]

# Dropping unused levels (only United States occurs). 
us_deaths_df$Location <- droplevels(us_deaths_df$Location)

```


## Data Structure  

### Observations and features  

#### Verify United States data set is smooth at merge (2019 to 2020).
#### **Note**: State level data will be verified in individual State analysis.   

```{r}
# melt(us_deaths_df[ Week_End_Date > as.Date("2019-09-01") & 
#                    Week_End_Date < as.Date("2020-03-31"),
#                    Week_End_Date:Abnormal_Finding],
#      id.vars = "Week_End_Date")




melt(us_deaths_df[ Week_End_Date > as.Date("2019-09-01") & 
                   Week_End_Date < as.Date("2020-03-31"),
                   Week_End_Date:Abnormal_Finding],
     id.vars = "Week_End_Date") %>%
  
  ggplot(aes(x=Week_End_Date, y = value, group=variable)) +
    geom_point() +
    geom_vline(xintercept=as.Date("2020-01-01"), linetype="dotted") +
    facet_wrap(~ variable, scales = 'free_y') + 
    theme_bw()
```

There are vertical gaps (jumps) seen at the intersection of the two data sets 
for: 
- Influenza and Pneumonia
- Other Respiratory
- Abnormal Finding

After the jumps, the data settles into a pattern consistent with the trend of 
the previous years' data. These gaps are likely related to Covid-19 cases that 
were undiagnosed due to Covid-19 testing not being available until March of 2020 
and not being widely available (without restricted use) until May of 2020. In 
addition, there was not a Covid-19 diagnosis of death code available in the 
United States on January 1st of 2020 and therefore any deaths would 
have been diagnosed as another general respiratory category such as these three.

In addition to the gaps, there are notable peaks at the merge point (date) of 
the two data sets. These peaks are generally smooth before and after, indicating 
a local anomaly with a true long-term pattern. 

The analysis will comprise mostly of averages and comparisons of year to year 
descriptive statistics. Therefore, 1-2 week gaps and trends will not effect the 
analysis. 

#### First three observations (chronologically) of the data set.  


```{r }
head(us_deaths_df, 3)

```

#### Last three observations (chronologically) of the data set.  

```{r }

tail(us_deaths_df, 3)

```

```{r }

str(us_deaths_df)

```



After preprocessing and cleaning, the United States (U.S.) subset of data used 
in this analysis accounts for 395 observations and 18 features which includes 
categorical location data, chronological date and week of year information, and 
integer weekly disease death data. The earliest week is the 1st week of January 
2014. The most current as of this analysis is the week ending January 24, 2021. 
Next, is the  data set's summary statistics in the U.S. subset.


#### Summary statistics  

```{r, message=FALSE, warning=FALSE }

as.data.frame(describeBy(us_deaths_df[ , -"Week_End_Date"]))


```

#### Summary statistics for Covid features (2020-2021)  

```{r, message=FALSE, warning=FALSE }

as.data.frame(describeBy(us_deaths_df[ Year > 2019, 
                                       .(Covid_19_Multi, Covid_19)]))



```

#### Distributions 2014-2021 (Covid deaths are zero prior to 2020)  

```{r, fig.width=10, fig.height=8}
us_deaths_df[ , Natural:Abnormal_Finding]%>%
  hist()
```


#### Distributions 2014-2021 (Covid distibutions are years 2020-2021)  

```{r, fig.width=8, fig.height=6}
par(mfrow=c(2,2))

  hist(us_deaths_df[ , Cancer], breaks = 32, 
       main = "Cancer", 
       xlab = "Weekly Cancer Deaths (bins=32)") 
  hist(us_deaths_df[ Year > 2019, Covid_19_Multi], breaks = 14, 
       main = "Covid-19 Comorbidity", 
       xlab = "Weekly Covid-19 Comorbidity Deaths (bins=14)")
  hist(us_deaths_df[ Year > 2019, Covid_19], breaks = 14, 
       main = "Covid-19 Singular Cause", 
       xlab = "Weekly Covid-19 Deaths (bins=14)")
  hist(us_deaths_df[ , Abnormal_Finding], breaks = 51, 
       main = "Abnormal Finding", 
       xlab = "Weekly Abnormal Finding Deaths (bins=51)")

par(mfrow=c(1,1))

```


```{r, fig.width=14, fig.height=14}
psych::pairs.panels(us_deaths_df[ , Natural:Abnormal_Finding], scale = TRUE)

```

```{r, fig.width=14, fig.height=14}
psych::pairs.panels(us_deaths_df[ Year > 2019 , Natural:Abnormal_Finding], scale = TRUE)

```



```{r, fig.width=10, fig.height=10}
psych::pairs.panels(us_deaths_df[ Year > 2019,
                                  .(Natural, Heart, Brain, Alzheimer, Diabetes, 
                                    Covid_19_Multi, Covid_19)], 
                    scale = TRUE)

```



# End of file


